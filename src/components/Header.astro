---
const navItems = [
    { linkText: 'Home', href: '/', icon: 'üè†' },
    { linkText: 'Forms', href: '/forms', icon: 'üìã' },
    { linkText: 'About', href: '/about', icon: 'üìñ' },
    { linkText: 'Warehouse', href: '/warehouse', icon: 'üì¶' },
    { linkText: 'Uniforms', href: '/uniforms', icon: 'üëî' },
    { linkText: 'Resources', href: '/resources', icon: 'üìö' },
    { linkText: 'Chain of Command', href: '/chain-of-command', icon: '‚õìÔ∏è' },
    { linkText: 'Events', href: '/community-events', icon: 'üìÖ' },
    { linkText: 'Arrests Database', href: '/arrests-database', icon: 'üîí' },
    { linkText: 'Admin', href: '/admin/login', icon: '‚öôÔ∏è' }
];
---

<nav class="flex flex-wrap items-center justify-between gap-4 pt-6 pb-6 sm:pt-8 sm:pb-8 border-b border-white/10">
    <a href="/" class="flex items-center gap-3 no-underline hover:opacity-100">
        <img src="/images/DPPD_Seal_3.png" alt="DPPD Seal" class="w-12 h-12 object-contain">
        <div class="flex flex-col">
            <span class="font-bold text-lg leading-tight">DPPD</span>
            <span class="text-xs text-white/60 leading-tight">Officer Hub</span>
        </div>
    </a>

    <!-- Site Navigation Button -->
    <button
        id="menu-toggle"
        class="site-nav-btn"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
    >
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="nav-btn-icon">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
        <span class="nav-btn-text">Site Navigation</span>
    </button>
</nav>

<!-- Popup Menu Backdrop -->
<div id="menu-backdrop" class="menu-backdrop"></div>

<!-- Popup Navigation Menu -->
<div id="popup-menu" class="popup-menu">
    <!-- Orange Header Bar -->
    <div class="popup-header">
        <span class="popup-title">Navigation</span>
        <button id="menu-close" class="popup-close" aria-label="Close menu">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>

    <!-- Menu Content -->
    <div class="popup-content">
        {
            !!navItems?.length && (
                <ul class="popup-nav-list">
                    {navItems.map((item) => (
                        <li>
                            <a href={item.href} class="popup-nav-link" data-text={item.linkText}>
                                <span class="popup-nav-icon">{item.icon}</span>
                                <span class="popup-nav-text">{item.linkText}</span>
                            </a>
                        </li>
                    ))}
                </ul>
            )
        }
    </div>
</div>

<style>
    /* Site Navigation Button */
    .site-nav-btn {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 18px;
        background: linear-gradient(135deg, rgba(249, 115, 22, 0.9) 0%, rgba(234, 88, 12, 0.9) 100%);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        color: white;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
    }

    .site-nav-btn:hover {
        background: linear-gradient(135deg, rgba(249, 115, 22, 1) 0%, rgba(234, 88, 12, 1) 100%);
        box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
        transform: translateY(-1px);
    }

    .site-nav-btn:active {
        transform: translateY(0);
    }

    .site-nav-btn[aria-expanded="true"] {
        background: linear-gradient(135deg, rgba(220, 38, 38, 0.9) 0%, rgba(185, 28, 28, 0.9) 100%);
        box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
    }

    .site-nav-btn[aria-expanded="true"]:hover {
        background: linear-gradient(135deg, rgba(220, 38, 38, 1) 0%, rgba(185, 28, 28, 1) 100%);
        box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
    }

    .nav-btn-icon {
        transition: transform 0.3s ease;
    }

    .site-nav-btn[aria-expanded="true"] .nav-btn-icon {
        transform: rotate(90deg);
    }

    .nav-btn-text {
        letter-spacing: 0.02em;
    }

    /* Backdrop overlay */
    .menu-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0);
        backdrop-filter: blur(0);
        z-index: 40;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .menu-backdrop.active {
        opacity: 1;
        visibility: visible;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
    }

    /* Popup Menu Container */
    .popup-menu {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.85);
        width: 90%;
        max-width: 400px;
        max-height: 80vh;
        background: linear-gradient(180deg, #1a2234 0%, #0f1520 100%);
        border-radius: 16px;
        box-shadow:
            0 25px 50px -12px rgba(0, 0, 0, 0),
            0 0 0 1px rgba(255, 255, 255, 0),
            0 0 40px rgba(249, 115, 22, 0);
        z-index: 50;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        overflow: hidden;
    }

    .popup-menu.active {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1);
        box-shadow:
            0 25px 50px -12px rgba(0, 0, 0, 0.5),
            0 0 0 1px rgba(255, 255, 255, 0.1),
            0 0 40px rgba(249, 115, 22, 0.15);
    }

    /* Orange Header Bar with gradient animation */
    .popup-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
        background: linear-gradient(135deg, #f97316 0%, #ea580c 50%, #dc2626 100%);
        background-size: 200% 200%;
        background-position: 0% 50%;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: background-position 0.5s ease;
    }

    .popup-menu.active .popup-header {
        animation: headerGradient 3s ease infinite;
    }

    @keyframes headerGradient {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    .popup-title {
        font-weight: 700;
        font-size: 1.125rem;
        color: white;
        letter-spacing: 0.025em;
        background: linear-gradient(90deg, #ffffff, #f97316, #fbbf24, #22c55e, #3b82f6, #a855f7, #ec4899, #ffffff);
        background-size: 400% 100%;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: titleColorShift 4s ease-in-out infinite;
    }

    @keyframes titleColorShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .popup-close {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.15);
        color: white;
        border: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .popup-close:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg) scale(1.1);
    }

    /* Menu Content with staggered fade-in */
    .popup-content {
        padding: 12px;
        max-height: calc(80vh - 80px);
        overflow-y: auto;
        background: linear-gradient(180deg, rgba(26, 34, 52, 0) 0%, rgba(15, 21, 32, 0.5) 100%);
    }

    /* Navigation List */
    .popup-nav-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .popup-nav-list li {
        opacity: 0;
        transform: translateX(-20px);
        transition: all 0.3s ease;
    }

    .popup-menu.active .popup-nav-list li {
        opacity: 1;
        transform: translateX(0);
    }

    /* Staggered animation for each item */
    .popup-menu.active .popup-nav-list li:nth-child(1) { transition-delay: 0.05s; }
    .popup-menu.active .popup-nav-list li:nth-child(2) { transition-delay: 0.1s; }
    .popup-menu.active .popup-nav-list li:nth-child(3) { transition-delay: 0.15s; }
    .popup-menu.active .popup-nav-list li:nth-child(4) { transition-delay: 0.2s; }
    .popup-menu.active .popup-nav-list li:nth-child(5) { transition-delay: 0.25s; }
    .popup-menu.active .popup-nav-list li:nth-child(6) { transition-delay: 0.3s; }
    .popup-menu.active .popup-nav-list li:nth-child(7) { transition-delay: 0.35s; }
    .popup-menu.active .popup-nav-list li:nth-child(8) { transition-delay: 0.4s; }
    .popup-menu.active .popup-nav-list li:nth-child(9) { transition-delay: 0.45s; }
    .popup-menu.active .popup-nav-list li:nth-child(10) { transition-delay: 0.5s; }

    /* Navigation Links with smooth color transitions */
    .popup-nav-link {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px 16px;
        border-radius: 10px;
        text-decoration: none;
        color: rgba(255, 255, 255, 0.85);
        font-size: 0.95rem;
        font-weight: 500;
        background: linear-gradient(135deg, transparent 0%, transparent 100%);
        border-left: 3px solid transparent;
        transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .popup-nav-link:hover {
        background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(234, 88, 12, 0.1) 100%);
        border-left-color: #f97316;
        color: white;
        transform: translateX(6px);
        box-shadow: inset 0 0 20px rgba(249, 115, 22, 0.1);
    }

    .popup-nav-icon {
        font-size: 1.25rem;
        width: 28px;
        text-align: center;
        filter: grayscale(40%) brightness(0.9);
        transition: all 0.35s ease;
    }

    .popup-nav-link:hover .popup-nav-icon {
        filter: grayscale(0%) brightness(1.1);
        transform: scale(1.15);
    }

    .popup-nav-text {
        flex: 1;
        transition: letter-spacing 0.3s ease;
        font-family: monospace;
        white-space: nowrap;
        overflow: hidden;
    }

    .popup-nav-link:hover .popup-nav-text {
        letter-spacing: 0.02em;
    }

    .popup-nav-text.typing {
        border-right: 2px solid #f97316;
        animation: cursorBlink 0.5s step-end infinite;
    }

    @keyframes cursorBlink {
        0%, 100% { border-right-color: #f97316; }
        50% { border-right-color: transparent; }
    }

    /* Custom Scrollbar with smooth appearance */
    .popup-content::-webkit-scrollbar {
        width: 6px;
    }

    .popup-content::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 3px;
    }

    .popup-content::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, rgba(249, 115, 22, 0.4) 0%, rgba(234, 88, 12, 0.4) 100%);
        border-radius: 3px;
        transition: background 0.3s ease;
    }

    .popup-content::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, rgba(249, 115, 22, 0.7) 0%, rgba(234, 88, 12, 0.7) 100%);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const menuToggle = document.getElementById('menu-toggle');
        const popupMenu = document.getElementById('popup-menu');
        const menuBackdrop = document.getElementById('menu-backdrop');
        const menuClose = document.getElementById('menu-close');

        // Typewriter effect state
        const typewriterState = new Map();

        function startTypewriter(link) {
            const textElement = link.querySelector('.popup-nav-text');
            const fullText = link.dataset.text;

            if (!textElement || !fullText) return;

            // Cancel any existing animation for this link
            if (typewriterState.has(link)) {
                clearTimeout(typewriterState.get(link).timeout);
            }

            textElement.classList.add('typing');

            let charIndex = 0;
            let isDeleting = false;
            const typingSpeed = 80;
            const deletingSpeed = 40;
            const pauseAtEnd = 500;
            const pauseAtStart = 200;

            function type() {
                if (!link.matches(':hover')) {
                    // Mouse left, restore full text and stop
                    textElement.textContent = fullText;
                    textElement.classList.remove('typing');
                    typewriterState.delete(link);
                    return;
                }

                if (!isDeleting) {
                    // Typing
                    textElement.textContent = fullText.substring(0, charIndex + 1);
                    charIndex++;

                    if (charIndex === fullText.length) {
                        // Finished typing, pause then start deleting
                        isDeleting = true;
                        typewriterState.set(link, { timeout: setTimeout(type, pauseAtEnd) });
                    } else {
                        typewriterState.set(link, { timeout: setTimeout(type, typingSpeed) });
                    }
                } else {
                    // Deleting
                    textElement.textContent = fullText.substring(0, charIndex);
                    charIndex--;

                    if (charIndex === 0) {
                        // Finished deleting, pause then start typing again
                        isDeleting = false;
                        typewriterState.set(link, { timeout: setTimeout(type, pauseAtStart) });
                    } else {
                        typewriterState.set(link, { timeout: setTimeout(type, deletingSpeed) });
                    }
                }
            }

            // Start with empty text and begin typing
            textElement.textContent = '';
            type();
        }

        function stopTypewriter(link) {
            const textElement = link.querySelector('.popup-nav-text');
            const fullText = link.dataset.text;

            if (typewriterState.has(link)) {
                clearTimeout(typewriterState.get(link).timeout);
                typewriterState.delete(link);
            }

            if (textElement && fullText) {
                textElement.textContent = fullText;
                textElement.classList.remove('typing');
            }
        }

        function openMenu() {
            popupMenu?.classList.add('active');
            menuBackdrop?.classList.add('active');
            menuToggle?.setAttribute('aria-expanded', 'true');
            document.body.style.overflow = 'hidden';
        }

        function closeMenu() {
            popupMenu?.classList.remove('active');
            menuBackdrop?.classList.remove('active');
            menuToggle?.setAttribute('aria-expanded', 'false');
            document.body.style.overflow = '';

            // Stop all typewriter animations when menu closes
            const menuLinks = popupMenu?.querySelectorAll('.popup-nav-link');
            menuLinks?.forEach(link => stopTypewriter(link));
        }

        if (menuToggle && popupMenu) {
            // Toggle menu on button click
            menuToggle.addEventListener('click', () => {
                const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
                if (isExpanded) {
                    closeMenu();
                } else {
                    openMenu();
                }
            });

            // Close menu on close button click
            menuClose?.addEventListener('click', closeMenu);

            // Close menu on backdrop click
            menuBackdrop?.addEventListener('click', closeMenu);

            // Close menu when clicking on a link
            const menuLinks = popupMenu.querySelectorAll('.popup-nav-link');
            menuLinks.forEach(link => {
                link.addEventListener('click', closeMenu);

                // Add typewriter effect on hover
                link.addEventListener('mouseenter', () => startTypewriter(link));
                link.addEventListener('mouseleave', () => stopTypewriter(link));
            });

            // Close menu on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && popupMenu.classList.contains('active')) {
                    closeMenu();
                }
            });
        }
    });
</script>
