---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Arrest Report Submission">
    <div class="space-y-8">
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Arrest Report Submission</h1>
            <p class="text-white/70">Submit a new arrest report for processing</p>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="hidden rounded-lg p-4 border">
        </div>

        <!-- Form -->
        <form id="arrestReportForm" class="space-y-6">
            <!-- Section 1: Discord Info -->
            <div class="bg-indigo-500/20 backdrop-blur-sm rounded-lg p-6 border border-indigo-500/30">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-indigo-400" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
                    </svg>
                    Section 1: Discord Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Discord Username <span class="text-red-400">*</span></label>
                        <input type="text" id="discordUsername" name="discordUsername" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="username#0000">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Discord ID <span class="text-red-400">*</span></label>
                        <input type="text" id="discordId" name="discordId" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="123456789012345678">
                        <p class="text-xs text-white/50 mt-1">Your Discord ID will be pinged as &lt;@ID&gt; in the report</p>
                    </div>
                </div>
            </div>

            <!-- Section 2: Officer and Suspect Info -->
            <div class="bg-blue-500/20 backdrop-blur-sm rounded-lg p-6 border border-blue-500/30">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    Section 2: Officer & Suspect Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Officer Name <span class="text-red-400">*</span></label>
                        <input type="text" id="officerName" name="officerName" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Officer John Smith">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Officer Callsign <span class="text-red-400">*</span></label>
                        <input type="text" id="officerCallsign" name="officerCallsign" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="1-ADAM-12">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Suspect Name <span class="text-red-400">*</span></label>
                        <input type="text" id="suspectName" name="suspectName" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Jane Doe">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Suspect DOB <span class="text-red-400">*</span></label>
                        <input type="text" id="suspectDob" name="suspectDob" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="01/15/1990">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Suspect Gender <span class="text-red-400">*</span></label>
                        <select id="suspectGender" name="suspectGender" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Non-Binary">Non-Binary</option>
                            <option value="Unknown">Unknown</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Suspect Image URL</label>
                        <input type="url" id="suspectImage" name="suspectImage" class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="https://example.com/image.png">
                        <p class="text-xs text-white/50 mt-1">Direct link to suspect's image (optional)</p>
                    </div>
                </div>
            </div>

            <!-- Section 3: Charges -->
            <div class="bg-purple-500/20 backdrop-blur-sm rounded-lg p-6 border border-purple-500/30">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                    </svg>
                    Section 3: Charges
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Reason for Initial Stop <span class="text-red-400">*</span></label>
                        <textarea id="reasonForStop" name="reasonForStop" required rows="3" class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none" placeholder="Describe the reason for the initial stop..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Suspect Behavior <span class="text-red-400">*</span></label>
                        <p class="text-xs text-white/50 mb-3">Select all that apply</p>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-700/30 px-3 py-2 rounded-lg hover:bg-slate-700/50 transition-colors">
                                <input type="checkbox" name="suspectBehavior" value="Compliant" class="w-4 h-4 text-purple-500 bg-slate-700 border-slate-600 rounded focus:ring-purple-500">
                                <span class="text-sm">Compliant</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-700/30 px-3 py-2 rounded-lg hover:bg-slate-700/50 transition-colors">
                                <input type="checkbox" name="suspectBehavior" value="Resistant" class="w-4 h-4 text-purple-500 bg-slate-700 border-slate-600 rounded focus:ring-purple-500">
                                <span class="text-sm">Resistant</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-700/30 px-3 py-2 rounded-lg hover:bg-slate-700/50 transition-colors">
                                <input type="checkbox" name="suspectBehavior" value="Aggressive" class="w-4 h-4 text-purple-500 bg-slate-700 border-slate-600 rounded focus:ring-purple-500">
                                <span class="text-sm">Aggressive</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-700/30 px-3 py-2 rounded-lg hover:bg-slate-700/50 transition-colors">
                                <input type="checkbox" name="suspectBehavior" value="Attempted to Flee" class="w-4 h-4 text-purple-500 bg-slate-700 border-slate-600 rounded focus:ring-purple-500">
                                <span class="text-sm">Attempted to Flee</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer bg-slate-700/30 px-3 py-2 rounded-lg hover:bg-slate-700/50 transition-colors">
                                <input type="checkbox" name="suspectBehavior" value="Assaultive" class="w-4 h-4 text-purple-500 bg-slate-700 border-slate-600 rounded focus:ring-purple-500">
                                <span class="text-sm">Assaultive</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">List of All Charges Applied <span class="text-red-400">*</span></label>
                        <textarea id="charges" name="charges" required rows="4" class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none" placeholder="List all charges (one per line)...&#10;- Speeding&#10;- Reckless Driving&#10;- DUI"></textarea>
                    </div>
                </div>
            </div>

            <!-- Section 4: Transporting and Booking -->
            <div class="bg-cyan-500/20 backdrop-blur-sm rounded-lg p-6 border border-cyan-500/30">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                    Section 4: Transporting & Booking
                </h2>
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Location of Booking <span class="text-red-400">*</span></label>
                        <input type="text" id="bookingLocation" name="bookingLocation" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:border-transparent" placeholder="Mission Row Police Station">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Suspect Statements</label>
                        <textarea id="suspectStatements" name="suspectStatements" rows="4" class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:border-transparent resize-none" placeholder="Record any statements made by the suspect during transport or booking..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Section 5: Finalization -->
            <div class="bg-amber-500/20 backdrop-blur-sm rounded-lg p-6 border border-amber-500/30">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Section 5: Finalization
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Were Miranda Rights Read? <span class="text-red-400">*</span></label>
                        <select id="mirandaRights" name="mirandaRights" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent">
                            <option value="">Select Option</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                            <option value="refused">Refused to Listen</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-1">Case Status <span class="text-red-400">*</span></label>
                        <select id="caseStatus" name="caseStatus" required class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent">
                            <option value="">Select Status</option>
                            <option value="open">Open</option>
                            <option value="closed">Closed</option>
                            <option value="unresolved">Unresolved</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-slate-300 mb-1">Additional Notes</label>
                        <textarea id="additionalNotes" name="additionalNotes" rows="4" class="w-full px-4 py-2 bg-slate-700/50 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none" placeholder="Any additional notes or observations..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-center">
                <button type="submit" id="submitBtn" class="px-8 py-3 bg-green-600 hover:bg-green-500 rounded-lg transition-colors font-bold text-lg shadow-lg hover:shadow-green-500/25">
                    Submit Arrest Report
                </button>
            </div>
        </form>
    </div>

    <script type="module">
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `rounded-lg p-4 border ${type === 'error' ? 'bg-red-500/20 border-red-500/50 text-red-200' : 'bg-green-500/20 border-green-500/50 text-green-200'}`;
            statusEl.classList.remove('hidden');

            // Scroll to status message
            statusEl.scrollIntoView({ behavior: 'smooth', block: 'center' });

            if (type === 'success') {
                setTimeout(() => statusEl.classList.add('hidden'), 10000);
            }
        }

        // Form submission
        document.getElementById('arrestReportForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            // Collect form data
            const formData = {
                discordUsername: document.getElementById('discordUsername').value,
                discordId: document.getElementById('discordId').value,
                officerName: document.getElementById('officerName').value,
                officerCallsign: document.getElementById('officerCallsign').value,
                suspectName: document.getElementById('suspectName').value,
                suspectDob: document.getElementById('suspectDob').value,
                suspectGender: document.getElementById('suspectGender').value,
                suspectImage: document.getElementById('suspectImage').value,
                reasonForStop: document.getElementById('reasonForStop').value,
                suspectBehavior: Array.from(document.querySelectorAll('input[name="suspectBehavior"]:checked')).map(cb => cb.value),
                charges: document.getElementById('charges').value,
                bookingLocation: document.getElementById('bookingLocation').value,
                suspectStatements: document.getElementById('suspectStatements').value,
                mirandaRights: document.getElementById('mirandaRights').value,
                caseStatus: document.getElementById('caseStatus').value,
                additionalNotes: document.getElementById('additionalNotes').value
            };

            // Validate at least one behavior is selected
            if (formData.suspectBehavior.length === 0) {
                showStatus('Please select at least one suspect behavior', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Arrest Report';
                return;
            }

            try {
                const response = await fetch('/api/arrest-reports', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    showStatus(`Arrest report submitted successfully! Report ID: ${result.report.id}`, 'success');
                    // Reset form
                    document.getElementById('arrestReportForm').reset();
                } else {
                    showStatus(result.error || 'Failed to submit arrest report', 'error');
                }
            } catch (error) {
                console.error('Submit error:', error);
                showStatus('Failed to submit arrest report. Please try again.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Arrest Report';
            }
        });
    </script>
</Layout>
